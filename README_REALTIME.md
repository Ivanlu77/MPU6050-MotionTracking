# MPU6050 实时数据传输和运动轨迹检测系统

## 系统概述

这个系统将原有的MPU6050项目重新架构，实现了树莓派端只负责数据传输，电脑端负责数据处理和可视化的分离式设计。支持实时运动轨迹检测和多种可视化模式。

## 系统架构

```
树莓派 (Raspberry Pi)          电脑 (PC)
┌─────────────────────┐       ┌─────────────────────┐
│   MPU6050传感器      │       │   实时数据接收器     │
│        ↓            │  UDP  │        ↓            │
│   数据收集程序       │ ────→ │   数据处理模块       │
│   (键盘控制's')     │       │        ↓            │
│                     │       │   可视化界面选择     │
│                     │       │   ├─基础可视化器     │
│                     │       │   └─运动轨迹检测器   │
└─────────────────────┘       └─────────────────────┘
```

## 文件说明

### 树莓派端 (Raspberry Pi)

1. **`collect_data_network.cpp`** - 网络版数据收集程序
   - 从MPU6050传感器读取数据
   - 通过UDP协议发送数据到电脑
   - **键盘控制**: 按's'开始/停止传输，按'q'退出，按'r'重置时间戳
   - 无需按钮和LED，纯键盘操作

2. **`Makefile_network`** - 编译配置文件
   - 编译网络版数据收集程序
   - 移除了wiringPi依赖

### 电脑端 (PC)

1. **`realtime_receiver.py`** - 实时数据接收器
   - 接收来自树莓派的UDP数据包
   - 实时处理传感器数据
   - 计算速度、位置、欧拉角等衍生数据
   - 提供数据缓存和保存功能

2. **`realtime_visualizer.py`** - 基础实时可视化程序
   - 多标签页GUI界面
   - 实时显示加速度、旋转、位置数据
   - 3D轨迹可视化
   - 数据保存和积分重置功能

3. **`realtime_motion_tracker.py`** - **新增** 运动轨迹检测器
   - 专注于运动轨迹分析
   - 实时运动状态检测（静止/缓慢移动/运动中）
   - 自动计算总距离和最大速度
   - 多视图显示：3D轨迹、XY平面、速度曲线、加速度分析
   - 生成运动分析报告

4. **`start_visualizer.py`** - 统一启动脚本
   - 提供程序选择菜单
   - 自动检查依赖包
   - 支持启动不同的可视化程序

5. **`requirements.txt`** - Python依赖包列表

## 安装和配置

### 树莓派端设置

1. **编译程序**
   ```bash
   cd "Collect data"
   make -f Makefile_network
   ```

2. **配置网络**
   - 编辑 `collect_data_network.cpp` 中的 `SERVER_IP` 
   - 将其改为您电脑的IP地址
   - 重新编译程序

3. **运行程序**
   ```bash
   sudo ./mpu6050_network
   ```

### 电脑端设置

1. **安装Python依赖**
   ```bash
   cd "Processing data"
   pip install -r requirements.txt
   ```

2. **运行可视化程序**
   ```bash
   python start_visualizer.py
   ```

## 使用方法

### 启动流程

1. **启动电脑端程序**
   - 运行 `python start_visualizer.py`
   - 选择要使用的可视化程序：
     - 选项1：基础实时可视化器（多标签页显示）
     - 选项2：运动轨迹检测器（专注轨迹分析）
   - 点击"开始接收/开始检测"按钮

2. **启动树莓派端程序**
   - 运行 `sudo ./mpu6050_network`
   - 等待系统初始化完成
   - **按's'键开始数据传输**
   - **按'q'键退出程序**
   - **按'r'键重置时间戳**

3. **实时可视化**
   - 在电脑端查看实时数据图表
   - 根据选择的程序查看不同类型的可视化

### 树莓派端控制命令

- **'s'** - 开始/停止数据传输
- **'q'** - 退出程序
- **'r'** - 重置时间戳

### 电脑端程序选择

#### 1. 基础实时可视化器
- **加速度数据**: 显示原始加速度、线性加速度、陀螺仪数据和积分速度
- **旋转数据**: 显示四元数、欧拉角和角速度
- **位置数据**: 显示3D位置和各平面的轨迹投影
- **3D可视化**: 实时3D轨迹显示

#### 2. 运动轨迹检测器 ? **推荐用于轨迹分析**
- **实时3D轨迹**: 主要的3D运动轨迹显示
- **XY平面轨迹**: 俯视图轨迹
- **速度分析**: 实时速度变化曲线
- **加速度分析**: 加速度幅值变化
- **运动状态检测**: 自动识别静止/缓慢移动/运动中
- **统计信息**: 总距离、最大速度、运动时长
- **分析报告**: 自动生成详细的运动分析报告

## 运动检测功能

### 自动状态识别
- **静止**: 加速度幅值 < 0.2 m/s?
- **缓慢移动**: 加速度幅值 0.2-0.5 m/s?
- **运动中**: 加速度幅值 > 0.5 m/s?

### 实时统计
- **总距离**: 自动计算运动轨迹的总长度
- **最大速度**: 记录运动过程中的最大瞬时速度
- **运动时长**: 从开始检测到当前的总时间

### 数据保存
- **CSV格式**: 原始传感器数据
- **分析报告**: 包含运动统计和轨迹范围的文本报告

## 网络配置

### 默认设置
- **协议**: UDP
- **端口**: 8888
- **数据包大小**: 42字节

### 数据包格式
```
时间戳 (8字节) + 加速度 (6字节) + 陀螺仪 (6字节) + 四元数 (16字节) + 线性加速度 (6字节)
```

## 故障排除

### 常见问题

1. **无法接收数据**
   - 检查网络连接
   - 确认IP地址配置正确
   - 检查防火墙设置
   - 确保在树莓派上按了's'键开始传输

2. **数据包丢失**
   - 检查网络稳定性
   - 使用有线网络连接
   - 确认UDP缓冲区大小

3. **可视化卡顿**
   - 减少显示的数据点数量
   - 调整动画更新频率
   - 检查电脑性能

4. **编译错误**
   - 确保已安装必要的开发工具
   - 检查I2C库是否正确安装
   - 确认MPU6050连接正常

### 树莓派端状态指示

程序运行时会显示：
- **READY**: 系统就绪，等待按's'开始传输
- **TRANSMITTING**: 正在传输数据
- 实时显示时间戳、加速度和四元数数据

## 性能优化

### 树莓派端
- 使用有线网络连接以减少延迟
- 确保I2C总线稳定
- 避免其他高负载程序同时运行

### 电脑端
- 使用运动轨迹检测器以获得更好的分析效果
- 调整缓冲区大小以平衡内存使用和数据完整性
- 使用更快的硬件以支持实时处理

## 应用场景

### 适用于以下运动分析：
1. **步行/跑步轨迹分析**
2. **手势识别和轨迹记录**
3. **物体运动轨迹跟踪**
4. **运动模式识别**
5. **位移和速度测量**

## 技术支持

如有问题，请检查：
1. 网络连接状态
2. 程序日志输出
3. 系统资源使用情况
4. 传感器连接状态
5. 是否正确按下控制键

---

**注意**: 
- 确保树莓派和电脑在同一网络中
- 使用运动轨迹检测器可获得更专业的运动分析
- 按's'键控制数据传输，无需额外硬件
- 网络延迟应保持在较低水平以获得最佳性能 